<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Recipe Protection - Confidential Culinary Technology</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', 'Consolas', monospace;
            background: #0a0e27;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 255, 255, 0.03) 2px, rgba(0, 255, 255, 0.03) 4px),
                linear-gradient(180deg, #0a0e27 0%, #1a1f3a 100%);
            color: #00ffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: #00ffff;
            padding: 40px 0;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #00ffff, 0 0 40px #ff00ff;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 20px #00ffff, 0 0 40px #ff00ff;
            }
            to {
                text-shadow: 0 0 30px #00ffff, 0 0 60px #ff00ff, 0 0 80px #00ffff;
            }
        }

        .header p {
            font-size: 1.2em;
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }

        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(10, 14, 39, 0.8);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3), inset 0 0 30px rgba(255, 0, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
            border-radius: 15px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 0.5;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.5), inset 0 0 30px rgba(255, 0, 255, 0.2);
        }

        .card h2 {
            color: #ff00ff;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #00ffff;
            padding-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #ff00ff;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #00ffff;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            color: #00ffff;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            background: rgba(0, 0, 0, 0.7);
        }

        .btn {
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }

        .btn:disabled {
            background: #1a1f3a;
            color: #4a5568;
            cursor: not-allowed;
            transform: none;
        }

        .status-panel {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            color: #00ffff;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .status-panel h3 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }

        .recipe-list {
            background: rgba(10, 14, 39, 0.8);
            border: 2px solid #ff00ff;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
        }

        .recipe-list h2 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .recipe-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #ff00ff;
            transition: all 0.3s ease;
        }

        .recipe-item:hover {
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            transform: translateX(5px);
        }

        .recipe-item h3 {
            color: #00ffff;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #00ffff;
        }

        .recipe-meta {
            color: #8b9dc3;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .recipe-meta strong {
            color: #ff00ff;
        }

        .secret-info {
            background: rgba(255, 0, 255, 0.1);
            border: 1px solid #ff00ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            color: #ff00ff;
        }

        .chef-badge {
            display: inline-block;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            color: #000;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-right: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .access-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .access-controls button {
            flex: 1;
            min-width: 120px;
        }

        .wallet-info {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #00ffff;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .access-controls {
                flex-direction: column;
            }

            .access-controls button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Secret Recipe Protection</h1>
            <p>Confidential Culinary Technology Using FHE Encryption</p>
        </div>

        <div class="wallet-info" id="walletInfo">
            <button class="btn" onclick="connectWallet()" id="connectBtn">Connect Wallet</button>
        </div>

        <div class="main-content">
            <div class="card">
                <h2>üë®‚Äçüç≥ Register as Chef</h2>
                <div class="form-group">
                    <label>Chef Name</label>
                    <input type="text" id="chefName" placeholder="Enter your chef name">
                </div>
                <div class="form-group">
                    <label>Specialty</label>
                    <input type="text" id="chefSpecialty" placeholder="e.g., Italian Cuisine, Molecular Gastronomy">
                </div>
                <button class="btn" onclick="registerChef()">Register Chef</button>
            </div>

            <div class="card">
                <h2>üìù Create Secret Recipe</h2>
                <div class="form-group">
                    <label>Recipe Name</label>
                    <input type="text" id="recipeName" placeholder="Name of your secret recipe">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="recipeCategory">
                        <option value="">Select category</option>
                        <option value="Appetizer">Appetizer</option>
                        <option value="Main Course">Main Course</option>
                        <option value="Dessert">Dessert</option>
                        <option value="Beverage">Beverage</option>
                        <option value="Sauce">Sauce</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Secret Ingredient 1 (ID)</label>
                    <input type="number" id="ingredient1" placeholder="Ingredient code (0-4294967295)">
                </div>
                <div class="form-group">
                    <label>Secret Ingredient 2 (ID)</label>
                    <input type="number" id="ingredient2" placeholder="Ingredient code (0-4294967295)">
                </div>
                <div class="form-group">
                    <label>Secret Ingredient 3 (ID)</label>
                    <input type="number" id="ingredient3" placeholder="Ingredient code (0-4294967295)">
                </div>
                <div class="form-group">
                    <label>Spice Level (0-10)</label>
                    <input type="number" id="spiceLevel" min="0" max="10" placeholder="0 = Mild, 10 = Extremely Hot">
                </div>
                <div class="form-group">
                    <label>Cooking Time (minutes)</label>
                    <input type="number" id="cookingTime" placeholder="Total cooking time in minutes">
                </div>
                <div class="form-group">
                    <label>Access Price (ETH)</label>
                    <input type="number" id="accessPrice" step="0.001" placeholder="0.01">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isPublic"> Make recipe public
                    </label>
                </div>
                <button class="btn" onclick="createRecipe()">Create Secret Recipe</button>
            </div>

            <div class="card">
                <h2>üîç Recipe Access</h2>
                <div class="form-group">
                    <label>Recipe ID</label>
                    <input type="number" id="accessRecipeId" placeholder="Enter recipe ID to access">
                </div>
                <button class="btn" onclick="requestAccess()">Request Access</button>
                <button class="btn" onclick="revealSecrets()">Reveal Recipe Secrets</button>
            </div>

            <div class="card">
                <h2>‚öôÔ∏è Chef Management</h2>
                <div class="form-group">
                    <label>Recipe ID</label>
                    <input type="number" id="manageRecipeId" placeholder="Recipe ID to manage">
                </div>
                <div class="form-group">
                    <label>Request ID</label>
                    <input type="number" id="requestId" placeholder="Access request ID">
                </div>
                <div class="access-controls">
                    <button class="btn" onclick="approveAccess()">Approve Access</button>
                    <button class="btn" onclick="denyAccess()">Deny Access</button>
                    <button class="btn" onclick="makePublic()">Make Public</button>
                </div>
            </div>
        </div>

        <div class="status-panel" id="statusPanel">
            <h3>üìä System Status</h3>
            <div id="statusContent">Connect wallet to view recipes and status...</div>
        </div>

        <div class="recipe-list" id="recipeList">
            <h2>üçΩÔ∏è Recipe Collection</h2>
            <div id="recipesContent">No recipes found. Create your first secret recipe!</div>
        </div>
    </div>

    <script>
        let provider;
        let signer;
        let contract;
        const contractAddress = "0x72E13974c2158A875bAdbc860bfe7A3d932AA612";

        const contractABI = [
            "function registerChef(string memory _name, string memory _specialty) external",
            "function createSecretRecipe(string memory _name, string memory _category, uint32 _ingredient1, uint32 _ingredient2, uint32 _ingredient3, uint8 _spiceLevel, uint32 _cookingTime, uint256 _accessPrice, bool _isPublic) external",
            "function requestRecipeAccess(uint256 _recipeId) external payable",
            "function approveAccess(uint256 _requestId) external",
            "function denyAccess(uint256 _requestId) external",
            "function revealRecipeSecrets(uint256 _recipeId) external",
            "function makeRecipePublic(uint256 _recipeId) external",
            "function getRecipeInfo(uint256 _recipeId) external view returns (string memory, string memory, address, bool, uint256, uint256)",
            "function getChefProfile(address _chef) external view returns (string memory, string memory, uint256, bool, uint256)",
            "function checkRecipeAccess(address _user, uint256 _recipeId) external view returns (bool)",
            "function getRecipeCount() external view returns (uint256)",
            "event RecipeCreated(uint256 indexed recipeId, address indexed chef, string name)",
            "event AccessRequested(uint256 indexed requestId, uint256 indexed recipeId, address indexed requester)",
            "event ChefRegistered(address indexed chef, string name)"
        ];

        async function connectWallet() {
            if (window.ethereum) {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = provider.getSigner();
                    contract = new ethers.Contract(contractAddress, contractABI, signer);

                    const address = await signer.getAddress();
                    const balance = await provider.getBalance(address);

                    document.getElementById('walletInfo').innerHTML = `
                        <p><strong>Connected:</strong> ${address.substring(0,8)}...${address.substring(address.length-6)}</p>
                        <p><strong>Balance:</strong> ${ethers.utils.formatEther(balance)} ETH</p>
                    `;

                    updateStatus("Wallet connected successfully!");
                    loadRecipes();
                    loadChefProfile();
                } catch (error) {
                    console.error("Error connecting wallet:", error);
                    updateStatus("Error connecting wallet: " + error.message);
                }
            } else {
                alert("Please install MetaMask!");
            }
        }

        async function registerChef() {
            try {
                if (!contract) {
                    alert("Please connect your wallet first!");
                    updateStatus("‚ùå Wallet not connected. Click 'Connect Wallet' button.");
                    return;
                }

                const name = document.getElementById('chefName').value;
                const specialty = document.getElementById('chefSpecialty').value;

                if (!name || !specialty) {
                    alert("Please fill in all chef details");
                    return;
                }

                updateStatus("Registering chef...");
                const tx = await contract.registerChef(name, specialty);
                await tx.wait();

                updateStatus(`Chef registered successfully! Transaction: ${tx.hash}`);
                loadChefProfile();
            } catch (error) {
                console.error("Error registering chef:", error);
                updateStatus("Error registering chef: " + error.message);
            }
        }

        async function createRecipe() {
            try {
                if (!contract) {
                    alert("Please connect your wallet first!");
                    updateStatus("‚ùå Wallet not connected. Click 'Connect Wallet' button.");
                    return;
                }

                const name = document.getElementById('recipeName').value;
                const category = document.getElementById('recipeCategory').value;
                const ingredient1 = parseInt(document.getElementById('ingredient1').value);
                const ingredient2 = parseInt(document.getElementById('ingredient2').value);
                const ingredient3 = parseInt(document.getElementById('ingredient3').value);
                const spiceLevel = parseInt(document.getElementById('spiceLevel').value);
                const cookingTime = parseInt(document.getElementById('cookingTime').value);
                const accessPrice = ethers.utils.parseEther(document.getElementById('accessPrice').value || "0");
                const isPublic = document.getElementById('isPublic').checked;

                if (!name || !category) {
                    alert("Please fill in recipe name and category");
                    return;
                }

                updateStatus("Creating secret recipe...");
                const tx = await contract.createSecretRecipe(
                    name, category, ingredient1, ingredient2, ingredient3,
                    spiceLevel, cookingTime, accessPrice, isPublic
                );
                await tx.wait();

                updateStatus(`Recipe created successfully! Transaction: ${tx.hash}`);
                loadRecipes();

                // Clear form
                document.getElementById('recipeName').value = '';
                document.getElementById('ingredient1').value = '';
                document.getElementById('ingredient2').value = '';
                document.getElementById('ingredient3').value = '';
                document.getElementById('spiceLevel').value = '';
                document.getElementById('cookingTime').value = '';
                document.getElementById('accessPrice').value = '';
                document.getElementById('isPublic').checked = false;
            } catch (error) {
                console.error("Error creating recipe:", error);
                updateStatus("Error creating recipe: " + error.message);
            }
        }

        async function requestAccess() {
            try {
                if (!contract) {
                    alert("Please connect your wallet first!");
                    updateStatus("‚ùå Wallet not connected. Click 'Connect Wallet' button.");
                    return;
                }

                const recipeId = parseInt(document.getElementById('accessRecipeId').value);
                if (!recipeId) {
                    alert("Please enter recipe ID");
                    return;
                }

                const recipeInfo = await contract.getRecipeInfo(recipeId);
                const accessPrice = recipeInfo[4];

                updateStatus("Requesting recipe access...");
                const tx = await contract.requestRecipeAccess(recipeId, {
                    value: accessPrice
                });
                await tx.wait();

                updateStatus(`Access requested successfully! Transaction: ${tx.hash}`);
            } catch (error) {
                console.error("Error requesting access:", error);
                updateStatus("Error requesting access: " + error.message);
            }
        }

        async function approveAccess() {
            try {
                if (!contract) {
                    alert("Please connect your wallet first!");
                    updateStatus("‚ùå Wallet not connected. Click 'Connect Wallet' button.");
                    return;
                }

                const requestId = parseInt(document.getElementById('requestId').value);
                if (!requestId) {
                    alert("Please enter request ID");
                    return;
                }

                updateStatus("Approving access...");
                const tx = await contract.approveAccess(requestId);
                await tx.wait();

                updateStatus(`Access approved successfully! Transaction: ${tx.hash}`);
            } catch (error) {
                console.error("Error approving access:", error);
                updateStatus("Error approving access: " + error.message);
            }
        }

        async function denyAccess() {
            try {
                if (!contract) {
                    alert("Please connect your wallet first!");
                    updateStatus("‚ùå Wallet not connected. Click 'Connect Wallet' button.");
                    return;
                }

                const requestId = parseInt(document.getElementById('requestId').value);
                if (!requestId) {
                    alert("Please enter request ID");
                    return;
                }

                updateStatus("Denying access...");
                const tx = await contract.denyAccess(requestId);
                await tx.wait();

                updateStatus(`Access denied successfully! Transaction: ${tx.hash}`);
            } catch (error) {
                console.error("Error denying access:", error);
                updateStatus("Error denying access: " + error.message);
            }
        }

        async function revealSecrets() {
            try {
                if (!contract) {
                    alert("Please connect your wallet first!");
                    updateStatus("‚ùå Wallet not connected. Click 'Connect Wallet' button.");
                    return;
                }

                const recipeId = parseInt(document.getElementById('accessRecipeId').value);
                if (!recipeId) {
                    alert("Please enter recipe ID");
                    return;
                }

                updateStatus("Revealing recipe secrets...");
                const tx = await contract.revealRecipeSecrets(recipeId);
                await tx.wait();

                updateStatus(`Recipe secrets revealed! Transaction: ${tx.hash}`);
            } catch (error) {
                console.error("Error revealing secrets:", error);
                updateStatus("Error revealing secrets: " + error.message);
            }
        }

        async function makePublic() {
            try {
                if (!contract) {
                    alert("Please connect your wallet first!");
                    updateStatus("‚ùå Wallet not connected. Click 'Connect Wallet' button.");
                    return;
                }

                const recipeId = parseInt(document.getElementById('manageRecipeId').value);
                if (!recipeId) {
                    alert("Please enter recipe ID");
                    return;
                }

                updateStatus("Making recipe public...");
                const tx = await contract.makeRecipePublic(recipeId);
                await tx.wait();

                updateStatus(`Recipe made public successfully! Transaction: ${tx.hash}`);
                loadRecipes();
            } catch (error) {
                console.error("Error making recipe public:", error);
                updateStatus("Error making recipe public: " + error.message);
            }
        }

        async function loadRecipes() {
            try {
                const recipeCount = await contract.getRecipeCount();
                let recipesHTML = '';

                for (let i = 1; i <= recipeCount; i++) {
                    try {
                        const recipeInfo = await contract.getRecipeInfo(i);
                        const hasAccess = await contract.checkRecipeAccess(await signer.getAddress(), i);

                        recipesHTML += `
                            <div class="recipe-item">
                                <h3>${recipeInfo[0]} <span class="chef-badge">Recipe #${i}</span></h3>
                                <div class="recipe-meta">
                                    <p><strong>Category:</strong> ${recipeInfo[1]}</p>
                                    <p><strong>Chef:</strong> ${recipeInfo[2]}</p>
                                    <p><strong>Status:</strong> ${recipeInfo[3] ? 'Public' : 'Private'}</p>
                                    <p><strong>Access Price:</strong> ${ethers.utils.formatEther(recipeInfo[4])} ETH</p>
                                    <p><strong>Created:</strong> ${new Date(recipeInfo[5] * 1000).toLocaleDateString()}</p>
                                </div>
                                ${hasAccess ? '<div class="secret-info">üîì You have access to this recipe\'s secrets!</div>' : '<div class="secret-info">üîí Request access to view recipe secrets</div>'}
                            </div>
                        `;
                    } catch (error) {
                        console.log(`Recipe ${i} not found or error:`, error);
                    }
                }

                document.getElementById('recipesContent').innerHTML = recipesHTML || 'No recipes found.';
            } catch (error) {
                console.error("Error loading recipes:", error);
                updateStatus("Error loading recipes: " + error.message);
            }
        }

        async function loadChefProfile() {
            try {
                const address = await signer.getAddress();
                const profile = await contract.getChefProfile(address);

                if (profile[3]) { // verified
                    updateStatus(`Welcome Chef ${profile[0]}! Specialty: ${profile[1]} | Recipes: ${profile[2]} | Reputation: ${profile[4]}`);
                } else {
                    updateStatus("Register as a chef to create recipes!");
                }
            } catch (error) {
                console.error("Error loading chef profile:", error);
            }
        }

        function updateStatus(message) {
            document.getElementById('statusContent').innerHTML = `
                <p><strong>${new Date().toLocaleTimeString()}:</strong> ${message}</p>
            `;
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', () => {
                    location.reload();
                });
            }
        });
    </script>
</body>
</html>